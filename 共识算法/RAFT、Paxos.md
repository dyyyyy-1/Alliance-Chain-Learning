# RAFT算法

## 概述

在wiki中是这样定义的：

> Raft是一种用于替代Paxos的共识算法。相比于Paxos，Raft的目标是提供更清晰的逻辑分工使得算法本身能被更好地理解，同时它安全性更高，并能提供一些额外的特性。[1][2]:1Raft能为在计算机集群之间部署有限状态机提供一种通用方法，并确保集群内的任意节点在某种状态转换上保持一致。Raft算法的开源实现众多，在Go、C++、Java以及 Scala中都有完整的代码实现。Raft这一名字来源于"Reliable, Replicated, Redundant, And Fault-Tolerant"（“可靠、可复制、可冗余、可容错”）的首字母缩写。[3]

- Paxos共识算法：本文后讲解

集群内的节点都对选举出的领袖采取信任，因此Raft不是一种拜占庭容错算法。

## RAFT算法解释 

在RAFT算法中有三种不同的角色，分别是：

1. 领导者（Leader）：负责日志复制和处理客户端请求。

2. 候选人（Candidate）：在领导者失效时竞选新的领导者。

3. 跟随者（Follower）：被动地响应来自领导者和候选人的请求。

正常情况下只会存在一名leader，其他节点都是follower。Leader 在收到来自客户端的请求后并不会执行，只是将其写入自己的日志列表中，然后将该操作发送给所有的 Follower。Follower 在收到请求后也只是写入自己的日志列表中然后回复 Leader，当有超过半数的结点写入后 Leader 才会提交该操作并返回给客户端，同时通知所有其他结点提交该操作。

当leader节点一定时间未响应后，达到了系统设定的定时器时间，系统会判定leader节点失效，并重新选举出一个leader。此时Candidate节点就会向其他节点发送选举请求，其他节点会判断Candidate是否能成为leader，如果超过半数节点通过了成为leader节点的申请，该节点会转换为新的leader，其余节点自动转换为follower。


# paxos算法

## 核心概念

paxos算法有三种角色：

1. 提议者（Proposers）：向系统中的节点提出提案。

2. 接受者（Acceptors）：在接收到提议后，对提议进行投票。

3. 学习者（Learners）：学习已经被接受的提案，通常是客户端或者其他系统组件。

## 工作阶段流程

Phase 1A - 准备阶段（Prepare Phase）：

提议者向多数接受者发送准备请求，请求投票。
接受者在收到准备请求后，比较提案的编号（编号唯一且递增）并回复自己最高编号的已接受提案（如果有的话）或者承诺不再接受编号小于当前提议的提案。

Phase 1B - 承诺阶段（Promise Phase）：

如果接受者收到的准备请求编号大于它之前见过的任何提议的编号，则接受者承诺不再接受任何编号小于此准备请求编号的提议，并回复之前接受的最高编号的提案内容。

Phase 2A - 提交阶段（Accept Phase）：

如果提议者收到多数接受者的承诺响应，它就可以发送一个包含提案值的接受请求。
接受者在收到接受请求后，如果没有收到更高编号的准备请求，就接受该提案值。



